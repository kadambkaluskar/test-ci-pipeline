name: Bump version
on:
  push:
    branches:
      - master
    pull_request:
     branches: [ master ]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master
        with:
          # Fetches entire history, so we can analyze commits since last tag
          fetch-depth: 0
      - name: Bump version and push tag
        uses: mathieudutour/github-tag-action@v4.5
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          default_bump: patch
          tag_prefix: v
          dry_run: true


# name: test_on_pr

# on:
#   push:
#     branches: [ master ]
#   pull_request:
#     branches: [ master ]


# jobs: 
#   increment_tag:
#     runs-on: ubuntu-latest

#     steps:
#       - name: Checkout code
#         with:
#           fetch-depth: 0
#         uses: actions/checkout@v2

#       - name: Run multiline script to increment tag
#         run: |
#           echo "hello world"
#           git fetch --tags
#           VERSION=`git describe --abbrev=0 --tags`
#           VERSION=${VERSION:-'0.0.0'}
#           echo $VERSION
#           VERSION_BITS=(${VERSION//./ })

#           VNUM1=${VERSION_BITS[0]}
#           VNUM2=${VERSION_BITS[1]}
#           VNUM3=${VERSION_BITS[2]}
#           VNUM3=$((VNUM3+1))

#           NEW_TAG="$VNUM1.$VNUM2.$VNUM3"

#           GIT_COMMIT=`git rev-parse HEAD`

#           NEEDS_TAG=`git describe --contains $GIT_COMMIT 2>/dev/null`

#           if [ -z "$NEEDS_TAG" ]; then
#             echo "git tag $NEW_TAG"
            
#             echo "Tagged with $NEW_TAG"
#             echo "git push --tags"
#           else
#             echo "Already a tag on this commit"
#           fi